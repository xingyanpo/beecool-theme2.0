{%- assign color_label_list = 'general.label.color' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign color_white_label = 'general.label.white' | t | downcase -%}
{%- assign size_label_list = 'general.label.size' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: product.id -%}

<div class="product-form">
  {%- for block in section.blocks -%}
    {%- case block.type -%}
        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          APP BLOCK TYPE
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when '@app' -%}
        {%- render block -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          VARIANT PICKER BLOCK TYPE
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'variant_picker' -%}
        <div class="mobile">
          <div class="product_pay">
            <div class="">
              <div class="price_title">Price</div>
              <product-meta form-id="{{ product_form_id }}" price-class="price--large" class="">
                <div class="price-list" data-product-price-list>
                  {%- if product.selected_or_first_available_variant.compare_at_price
                      > product.selected_or_first_available_variant.price
                  -%}
                    <span class="price price--highlight price--large">
                      <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>

                      {%- if settings.currency_code_enabled -%}
                        {{- product.selected_or_first_available_variant.price | money_with_currency -}}
                      {%- else -%}
                        {{- product.selected_or_first_available_variant.price | money -}}
                      {%- endif -%}
                    </span>

                    <span class="price price--compare">
                      <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>

                      {%- if settings.currency_code_enabled -%}
                        {{- product.selected_or_first_available_variant.compare_at_price | money_with_currency -}}
                      {%- else -%}
                        {{- product.selected_or_first_available_variant.compare_at_price | money -}}
                      {%- endif -%}
                    </span>
                  {%- else -%}
                    <span class="price price--large price--highlight">
                      <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                      {%- if settings.currency_code_enabled -%}
                        {{- product.selected_or_first_available_variant.price | money_with_currency -}}
                      {%- else -%}
                        {{- product.selected_or_first_available_variant.price | money -}}
                      {%- endif -%}
                    </span>
                  {%- endif -%}

                  {%- if product.selected_or_first_available_variant.unit_price_measurement -%}
                    <div class="price text--subdued">
                      <div class="unit-price-measurement">
                        <span class="unit-price-measurement__price">
                          {{- product.selected_or_first_available_variant.unit_price | money -}}
                        </span>
                        <span class="unit-price-measurement__separator">/</span>

                        {%- if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1
                        -%}
                          <span class="unit-price-measurement__reference-value">
                            {{- product.selected_or_first_available_variant.unit_price_measurement.reference_value -}}
                          </span>
                        {%- endif -%}

                        <span class="unit-price-measurement__reference-unit">
                          {{- product.selected_or_first_available_variant.unit_price_measurement.reference_unit -}}
                        </span>
                      </div>
                    </div>
                  {%- endif -%}
                </div>
              </product-meta>
            </div>

            <div class="product-payment__item-right">
              <span class="pack_item">As low as</span>
              <div class="product-payment__item-right_box">
                <span class="pack_item pack_title"
                  ><span style="font-size: 1.1em;">${{ product.price | divided_by: 600.0 | round: 1 }}</span>/m at 0%
                  APR</span
                >
                <small class="pack_item"
                  >With
                  <img
                    class="grid-product__price"
                    src="//cdn.shopify.com/s/files/1/0255/9528/1483/files/paypal_credit1.svg?v=1599114685"
                    alt="paypal_credit"
                    width="60px"
                  >
                  <span class="modal-popup modal-popup__link js-no-transition" popupId="popup_paypal"
                    >View details</span
                  >
                  {%- render 'paypal-credit' -%}
                </small>
              </div>
            </div>
          </div>
        </div>
        {%- unless product.has_only_default_variant
          or block.settings.hide_sold_out_variants
          and product.available == false
        -%}
          {%- assign size_chart_page = block.settings.size_chart_page -%}
          {%- assign found_size_option = false -%}

          <product-variants
            handle="{{ product.handle }}"
            form-id="{{ product_form_id }}"
            {% if update_url %}
              update-url
            {% endif %}
            {% if block.settings.hide_sold_out_variants %}
              hide-sold-out-variants
            {% endif %}
            class="product-form__variants"
            {{ block.shopify_attributes }}
          >
            {%- for option in product.options_with_values -%}
              {%- assign option_downcase = option.name | downcase -%}
              {%- capture option_id -%}option-{{ section.id }}-{{ template.suffix }}-{{ product.id }}-{{ forloop.index }}{%- endcapture -%}

              {%- assign selector_type = block.settings.selector_mode -%}

              {% if color_label_list contains option_downcase %}
                {%- assign selector_type = block.settings.color_mode -%}

                {%- if selector_type == 'variant_image' -%}
                  {%- comment -%}To use this mode every variant must have an attached media{%- endcomment -%}
                  {%- for variant in product.variants -%}
                    {%- unless variant.featured_media -%}
                      {%- assign selector_type = 'color' -%}
                      {%- break -%}
                    {%- endunless -%}
                  {%- endfor -%}
                {%- endif -%}
              {%- endif -%}

              <div
                class="{%if option.name contains "color" or  option.name contains "Color" %}product-form__option-selectors {%else%} product-form__option-selector  {% endif %} "
                data-selector-type="{{ selector_type | replace: '_', '-' | escape }}"
              >
                <div class="product-form__option-info">
                  <span class="product-form__option-name">{{ option.name }} - </span>

                  {%- if selector_type != 'dropdown' -%}
                    <span id="{{ option_id }}-value" class="product-form__option-value">
                      {{- option.selected_value -}}
                    </span>
                  {%- endif -%}

                  {%- if size_chart_page != blank and size_label_list contains option_downcase -%}
                    {%- assign found_size_option = true -%}
                    <button
                      type="button"
                      is="toggle-button"
                      class="product-form__option-link link text--subdued hidden-phone"
                      aria-controls="product-{{ section.id }}-{{ product.id }}-size-chart-drawer"
                      aria-expanded="false"
                    >
                      {{ 'product.general.size_chart' | t }}
                    </button>
                    <button
                      type="button"
                      is="toggle-button"
                      class="product-form__option-link link text--subdued hidden-tablet-and-up"
                      aria-controls="product-{{ section.id }}-{{ product.id }}-size-chart-popover"
                      aria-expanded="false"
                    >
                      {{ 'product.general.size_chart' | t }}
                    </button>
                  {%- endif -%}
                </div>

                {%- case selector_type -%}
                  {%- when 'variant_image' -%}
                    <div class="variant-swatch-list">
                      {%- assign option_position0 = option.position | minus: 1 -%}

                      {%- for value in option.values -%}
                        {%- comment -%}We search for the first variant that has an image for this color{%- endcomment -%}
                        {%- for variant in product.variants -%}
                          {%- if variant.options[option_position0] == value -%}
                            <div class="variant-swatch">
                              <input
                                class="variant-swatch__radio visually-hidden"
                                type="radio"
                                name="option{{ option.position }}"
                                form="{{ product_form_id }}"
                                id="{{ option_id }}-{{ forloop.index }}"
                                value="{{ value | escape }}"
                                data-bind-value="{{ option_id }}-value"
                                {% if value == option.selected_value %}
                                  checked="checked"
                                {% endif %}
                                aria-label="{{ value | escape }}"
                              >
                              <label class="variant-swatch__item" for="{{ option_id }}-{{ forloop.index }}">
                                <span class="visually-hidden">{{ value }}</span>
                                <img
                                  class="variant-swatch__image"
                                  loading="lazy"
                                  sizes="(max-width: 740px) 64px, 72px"
                                  {% render 'image-attributes',
                                    image: variant.featured_media,
                                    sizes: '64,72,128,144,192,216'
                                  %}
                                >
                              </label>
                            </div>
                            {%- break -%}
                          {%- endif -%}
                        {%- endfor -%}
                      {%- endfor -%}
                    </div>
                  {%- when 'color' -%}
                    <div class="color-swatch-list" data-product-id="{{ product.selected_or_first_available_variant.id }}">
                      {%- assign color_swatch_config = settings.color_swatch_config
                        | newline_to_br
                        | split: '<br />'
                      -%}

                      {%- for value in option.values -%}
                        {%- assign color_value_downcase = value | downcase -%}

                        <div class="color-swatch {% if color_white_label == color_value_downcase %}color-swatch--white{% endif %}">
                          <input
                            class="color-swatch__radio visually-hidden"
                            type="radio"
                            name="option{{ option.position }}"
                            form="{{ product_form_id }}"
                            id="{{ option_id }}-{{ forloop.index }}"
                            value="{{ value | escape }}"
                            {% if value == option.selected_value %}
                              checked="checked"
                            {% endif %}
                            data-bind-value="{{ option_id }}-value"
                          >
                          <label
                            class="color-swatch__item"
                            for="{{ option_id }}-{{ forloop.index }}"
                            style="{% render 'color-swatch-style', color_swatch_config: color_swatch_config, value: value %}"
                          >
                            <span class="visually-hidden">{{ value }}</span>
                          </label>
                        </div>
                      {%- endfor -%}
                    </div>
                  {%- when 'block' -%}
                    <div class="block-swatch-list">
                      {%- for value in option.values -%}
                        <div class="block-swatch">
                          <input
                            class="block-swatch__radio visually-hidden"
                            type="radio"
                            name="option{{ option.position }}"
                            form="{{ product_form_id }}"
                            id="{{ option_id }}-{{ forloop.index }}"
                            value="{{ value | escape }}"
                            {% if value == option.selected_value %}
                              checked="checked"
                            {% endif %}
                            data-bind-value="{{ option_id }}-value"
                          >
                          <label class="block-swatch__item" for="{{ option_id }}-{{ forloop.index }}">
                            {{- value -}}
                          </label>
                        </div>
                      {%- endfor -%}
                    </div>
                  {%- when 'dropdown' -%}
                    <div class="select-wrapper">
                      <combo-box
                        initial-focus-selector="[aria-selected='true']"
                        id="{{ option_id }}-combo-box"
                        class="combo-box"
                      >
                        <span class="combo-box__overlay"></span>

                        <header class="combo-box__header">
                          <p class="combo-box__title heading h6">{{ option.name }}</p>

                          <button
                            type="button"
                            class="combo-box__close-button tap-area"
                            data-action="close"
                            title="{{ 'general.accessibility.close' | t | escape }}"
                          >
                            {%- render 'icon' with 'close' -%}
                          </button>
                        </header>

                        <div class="combo-box__option-list" role="listbox">
                          {%- for value in option.values -%}
                            <button
                              type="button"
                              role="option"
                              class="combo-box__option-item"
                              value="{{ value | escape }}"
                              aria-selected="{% if value == option.selected_value %}true{% else %}false{% endif %}"
                            >
                              {{ value }}
                            </button>
                          {%- endfor -%}
                        </div>

                        <select
                          class="visually-hidden"
                          name="option{{ option.position }}"
                          form="{{ product_form_id }}"
                          data-bind-value="{{ option_id }}-value"
                          aria-label="{{ option.name | escape }}"
                        >
                          {%- for value in option.values -%}
                            <option
                              value="{{ value | escape }}"
                              {% if value == option.selected_value %}
                                selected
                              {% endif %}
                            >
                              {{ value }}
                            </option>
                          {%- endfor -%}
                        </select>
                      </combo-box>

                      <button
                        type="button"
                        is="toggle-button"
                        class="select"
                        aria-expanded="false"
                        aria-haspopup="listbox"
                        aria-controls="{{ option_id }}-combo-box"
                      >
                        <span id="{{ option_id }}-value" class="select__selected-value">
                          {{- option.selected_value -}}
                        </span>
                        {%- render 'icon' with 'chevron' -%}
                      </button>
                    </div>
                {%- endcase -%}
              </div>
            {%- endfor -%}

            <noscript>
              <label class="input__block-label" for="product-select-{{ section.id }}-{{ product.id }}">
                {{- 'product.form.variant' | t -}}
              </label>

              <div class="select-wrapper">
                <select
                  class="select"
                  autocomplete="off"
                  id="product-select-{{ section.id }}-{{ product.id }}"
                  name="id"
                  form="{{ product_form_id }}"
                >
                  {%- for variant in product.variants -%}
                    <option
                      {% if variant == product.selected_or_first_available_variant %}
                        selected="selected"
                      {% endif %}
                      {% unless variant.available %}
                        disabled="disabled"
                      {% endunless %}
                      value="{{ variant.id }}"
                      data-sku="{{ variant.sku }}"
                    >
                      {{ variant.title }} - {{ variant.price | money }}
                    </option>
                  {%- endfor -%}
                </select>

                {%- render 'icon' with 'chevron' -%}
              </div>
            </noscript>
          </product-variants>
        {%- endunless -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          LINE ITEM PROPERTY
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'line_item_property' -%}
        {%- if block.settings.label != blank -%}
          {%- case block.settings.type -%}
            {%- when 'text' -%}
              {%- if block.settings.allow_long_text -%}
                <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
                  <label class="input__block-label" for="line-item-{{ section.id }}-{{ block.id }}">
                    {{- block.settings.label | escape }}:</label
                  >
                  <textarea
                    {% if block.settings.required %}
                      required
                    {% endif %}
                    id="line-item-{{ section.id }}-{{ block.id }}"
                    form="{{ product_form_id }}"
                    class="input__field input__field--textarea"
                    name="properties[{{ block.settings.label | escape }}]"
                  ></textarea>
                </div>
              {% else %}
                <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
                  <label class="input__block-label" for="line-item-{{ section.id }}-{{ block.id }}">
                    {{- block.settings.label | escape }}:</label
                  >
                  <input
                    {% if block.settings.required %}
                      required
                    {% endif %}
                    id="line-item-{{ section.id }}-{{ block.id }}"
                    form="{{ product_form_id }}"
                    type="text"
                    class="input__field"
                    name="properties[{{ block.settings.label | escape }}]"
                  >
                </div>
              {%- endif -%}
            {%- when 'checkbox' -%}
              <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
                <div class="checkbox-container">
                  <input
                    type="hidden"
                    form="{{ product_form_id }}"
                    class="checkbox"
                    name="properties[{{ block.settings.label | escape }}]"
                    value="{{ block.settings.unchecked_value | escape }}"
                  >
                  <input
                    type="checkbox"
                    form="{{ product_form_id }}"
                    class="checkbox"
                    name="properties[{{ block.settings.label | escape }}]"
                    id="line-item-{{ section.id }}-{{ block.id }}"
                    value="{{ block.settings.checked_value | escape }}"
                  >
                  <label for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label | escape }}</label>
                </div>
              </div>
          {%- endcase -%}
        {%- endif -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          TEXT
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'text' -%}
        {% if block.settings.text != blank %}
          <div class="product_tab">
            <div class="product_tab_title">
              {{- block.settings.title -}}
              <svg
                aria-hidden="true"
                focusable="false"
                role="presentation"
                class="icon icon--wide icon-chevron-down"
                viewBox="0 0 28 16"
              >
                <path d="M1.57 1.59l12.76 12.77L27.1 1.59" stroke-width="2" stroke="#000" fill="none" fill-rule="evenodd"></path>
              </svg>
            </div>
            <div class="product-form__text" {{ block.shopify_attributes }}>
              {{- block.settings.text -}}
            </div>
            <!-- 配件弹窗 -->

            <div class="x-popup-global x-popup-global-active">
              {% if product.metafields.custom.details_of_accessories.value != blank %}
                <div class="x-popup-global-content">
                  <div class="x-popup-global-contentBoxTop">
                    <div class="x_popup_left">
                      <div class="x_popup_global_left">
                        {% for itemLeft in product.metafields.custom.details_of_accessories.value %}
                          <div class="x_popup_globalLeft_title">{{ itemLeft.title }}</div>
                          <div class="x_popup_globalLeft_text">{{ itemLeft.text }}</div>
                        {% endfor %}
                      </div>
                      <div class="x_popup_global_banner pc">
                        {% for itemLeft in product.metafields.custom.details_of_accessories.value %}
                          <img src="{{itemLeft.img}}" alt="">
                        {% endfor %}
                      </div>
                    </div>

                    <div class="x_popup_global_right">
                      {% for item in product.metafields.custom.details_of_accessories_right.value %}
                        <div class="x_popup_globalLeft_right">
                          <div class="x_popup_globalRight_title">{{ item.title }}</div>
                          <div class="x_popup_globalLeft_rightBox">
                            {% for item2 in item.models %}
                              <div class="x_popup_globalRight_text">
                                <div>{{ item2.text }}</div>
                              </div>
                            {% endfor %}
                          </div>
                        </div>
                      {% endfor %}
                    </div>

                    <div class="x_popup_global_banner mobile">
                      {% for itemLeft in product.metafields.custom.details_of_accessories.value %}
                        <img src="{{itemLeft.img}}" alt="">
                      {% endfor %}
                    </div>
                  </div>
                  <div class="x-popup-global-contentBoxBottom">
                    <div class="swiper popupSwiper">
                      <div class="swiper-wrapper">
                        {% for item in product.metafields.custom.details_of_accessories_img.value %}
                          <div class="swiper-slide x-popup-global-contentBottomBox">
                            <div class="x-popup-global-contentBottomBoxImg ">
                              <img src="{{item.img}}" alt="">
                            </div>
                            <div>
                              {{ item.text }}
                            </div>
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                  </div>
                </div>
              {% endif %}
              <button class="close-popup-global"></button>
            </div>
          </div>
        {%- endif -%}
      {%- when 'saveText' -%}
        {%- capture product_labels -%}
            {%- for tag in product.tags -%}
              {%- if tag contains '__label' -%}
                <span class="label label--custom{% if tag contains '__label2' %}2{% endif %}">{{ tag | split: ':' | last }}</span>
              {%- endif -%}
            {%- endfor -%}
        
            {%- unless product.available -%}
              <span class="label label--subdued">{{ 'collection.product.sold_out' | t }}</span>
            {%- endunless -%}
        
            {%- assign cheapest_variant = product.variants | sort: 'price' | first -%}
        
            {%- if settings.show_discount and product.available and product.price < product.compare_at_price and cheapest_variant.compare_at_price != blank -%}
              {%- if settings.discount_mode == 'percentage' -%}
                {%- assign savings = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round | append: '%' -%}
              {%- else -%}
                {%- capture savings -%}{{ product.compare_at_price | minus: product.price | money_with_currency }}{%- endcapture -%}
              {%- endif -%}
        
            <div>
              
                    
              <span class="label label--highlights priceNew">{{ 'collection.product.discount_html' | t: savings: savings }}</span>
            </div>
            
            {%- endif -%}
      {%- endcapture -%}
        {{ product_labels }}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          IMAGE
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'image' -%}
        <div
          class="product-form__image product-form__image--{{ block.settings.image_alignment }}"
          {{ block.shopify_attributes }}
        >
          {%- capture image_sizes -%}{{ block.settings.image_width }}, {{ block.settings.image_width | times: 2 }}, {{ block.settings.image_width | times: 3 }}{%- endcapture -%}
          {% if block.settings.image != blank %}
            <img
              loading="lazy"
              style="max-width: {{ block.settings.image_width }}px"
              {% render 'image-attributes', image: block.settings.image, sizes: image_sizes %}
            >
          {% endif %}

          <div class="product-form__image_top">
            {{ block.settings.text }}
          </div>

<!--           {%- if block.settings.ship != blank -%}
            <div class="product-form__image_bottom"><span></span>{{ block.settings.ship }}</div>
          {%- endif -%} -->
        </div>

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          BUTTON
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'button' -%}
        {% if block.settings.link != blank and block.settings.text != blank %}
          <div class="product-form__button" {{ block.shopify_attributes }}>
            {%- if block.settings.background == 'rgba(0,0,0,0)' -%}
              {%- assign button_background = settings.primary_button_background -%}
            {%- else -%}
              {%- assign button_background = block.settings.background -%}
            {%- endif -%}

            {%- if block.settings.text_color == 'rgba(0,0,0,0)' -%}
              {%- assign button_text_color = settings.primary_button_text_color -%}
            {%- else -%}
              {%- assign button_text_color = block.settings.text_color -%}
            {%- endif -%}

            {%- capture button_background_rgb -%}{{ button_background.red }}, {{ button_background.green }}, {{ button_background.blue }}{%- endcapture -%}
            {%- capture button_text_color_rgb -%}{{ button_text_color.red }}, {{ button_text_color.green }}, {{ button_text_color.blue }}{%- endcapture -%}

            <a
              href="{{ block.settings.link }}"
              class="button button--primary {% if block.settings.stretch %}button--full{% endif %}"
              style="--primary-button-background: {{ button_background_rgb }}; --primary-button-text-color: {{ button_text_color_rgb }}"
            >
              {{- block.settings.text | escape -}}
            </a>
          </div>
        {%- endif -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          CUSTOM LIQUID
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'liquid' -%}
        {% if block.settings.liquid != blank %}
          <div class="product-form__custom-liquid" {{ block.shopify_attributes }}>
            {{- block.settings.liquid -}}
          </div>
        {%- endif -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          QUANTITY SELECTOR
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'quantity_selector' -%}
        {%- if request.page_type != 'password' and product.available -%}
          <div class="product-form__quantity" {{ block.shopify_attributes }}>
            <span class="product-form__quantity-label">{{ 'product.form.quantity' | t }}</span>

            <quantity-selector class="quantity-selector">
              <button type="button" class="quantity-selector__button">
                <span class="visually-hidden">{{ 'cart.general.decrease_quantity' | t }}</span>
                {%- render 'icon' with 'minus-big' -%}
              </button>

              <input
                type="text"
                form="{{ product_form_id }}"
                is="input-number"
                class="quantity-selector__input"
                inputmode="numeric"
                name="quantity"
                autocomplete="off"
                min="1"
                value="1"
                size="2"
                aria-label="{{ 'product.form.quantity' | t | escape }}"
              >

              <button type="button" class="quantity-selector__button">
                <span class="visually-hidden">{{ 'cart.general.increase_quantity' | t }}</span>
                {%- render 'icon' with 'plus-big' -%}
              </button>
            </quantity-selector>
          </div>
        {%- endif -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          PRODUCT DESCRIPTION
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'description' -%}
        {%- if product.description != blank -%}
          <div class="product-form__description rte" {{ block.shopify_attributes }}>
            {{- product.description -}}
          </div>
        {%- endif -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------
          INVENTORY
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'inventory' -%}
        {%- if product.template_suffix != 'pre-order'
          and product.available
          or product.selected_or_first_available_variant.incoming
        -%}
          <product-inventory
            form-id="{{ product_form_id }}"
            {% unless product.selected_or_first_available_variant.available
              or product.selected_or_first_available_variant.incoming
            %}
              hidden
            {% endunless %}
            class="product-form__inventory-wrapper"
            {{ block.shopify_attributes }}
          >
            {%- if product.selected_or_first_available_variant.available -%}
              {%- if product.selected_or_first_available_variant.inventory_management
                and product.selected_or_first_available_variant.inventory_policy == 'deny'
                and product.selected_or_first_available_variant.inventory_quantity
                  <= block.settings.low_inventory_threshold
                and block.settings.low_inventory_threshold > 0
              -%}
                <span class="inventory inventory--low">
                  {{-
                    'product.form.low_stock_with_quantity_count'
                    | t: count: product.selected_or_first_available_variant.inventory_quantity
                  -}}
                </span>
              {%- else -%}
                {%- if product.selected_or_first_available_variant.inventory_policy == 'continue'
                  and product.selected_or_first_available_variant.inventory_quantity <= 0
                  and product.selected_or_first_available_variant.requires_shipping
                -%}
                  {%- if product.selected_or_first_available_variant.incoming
                    and product.selected_or_first_available_variant.next_incoming_date
                  -%}
                    {%- capture next_incoming_date -%}{{ product.selected_or_first_available_variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                    <span class="inventory inventory--low">
                      {{- 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date -}}
                    </span>
                  {%- else -%}
                    <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
                  {%- endif -%}
                {%- else -%}
                  <span class="inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
                {%- endif -%}
              {%- endif -%}
            {%- elsif product.selected_or_first_available_variant.incoming -%}
              {%- if product.selected_or_first_available_variant.next_incoming_date -%}
                {%- capture next_incoming_date -%}{{ product.selected_or_first_available_variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                <span class="inventory inventory--low">
                  {{- 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date -}}
                </span>
              {%- else -%}
                <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
              {%- endif -%}
            {%- endif -%}

            <script type="application/json">
              {
                {%- for variant in product.variants -%}
                  {%- capture inventory_message -%}
                    {%- if variant.available -%}
                      {%- if variant.inventory_management and variant.inventory_policy == 'deny' and variant.inventory_quantity <= block.settings.low_inventory_threshold and block.settings.low_inventory_threshold > 0 -%}
                        <span class="inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count: variant.inventory_quantity }}</span>
                      {%- else -%}
                        {%- if variant.inventory_policy == 'continue' and variant.inventory_quantity <= 0 and variant.requires_shipping -%}
                          {%- if variant.incoming and variant.next_incoming_date -%}
                            {%- capture next_incoming_date -%}{{ variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                            <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
                          {%- else -%}
                            <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
                          {%- endif -%}
                        {%- else -%}
                          <span class="inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
                        {%- endif -%}
                      {%- endif -%}
                    {%- elsif variant.incoming -%}
                      {%- if variant.next_incoming_date -%}
                        {%- capture next_incoming_date -%}{{ variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                        <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
                      {%- else -%}
                        <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
                      {%- endif -%}
                    {%- endif -%}
                  {%- endcapture -%}

                  "{{ variant.id }}": {{ inventory_message | json }}{% unless forloop.last %},{% endunless %}
                {%- endfor -%}
              }
            </script>
          </product-inventory>
        {%- endif -%}

        {%- comment -%}
          ----------------------------------------------------------------------------------------------------------------


          BUY BUTTONS
          ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
      {%- when 'off' -%}
        <div class="product_off" {{ block.shopify_attributes }}>
          <div class="product_off_img copy_code_btn" style="background-color: {{ block.settings.copy_back_color }}">
            <img src="{{block.settings.copy_img | img_url: '200x'}}" width="50" height="50" alt="coupon">
            <div class="dis_code" style="display:none;">{{ block.settings.copy_text }}</div>
            {% if block.settings.is_can_copy %}
              <div class="copy_code_btn_Tips" style="display: none;">Click to copy code</div>
            {% endif %}
          </div>
          <div class="product_off_content">
            <div class="pack_title">
              {{ block.settings.title }}
            </div>
            <div class="pack_item">
              {{ block.settings.text }}
            </div>
          </div>
        </div>
      {%- when 'fedex' -%}
        <div class="fedex_all_box">
          <div class="fedex_all_boxTitle">
            {{ block.settings.fedex_title }}
          </div>
          <div class="fedex_all_boxBOttom">
            <div class="fedex_all_boxBOttom_img">
              <img loading="lazy" {% render 'image-attributes', image: block.settings.img %}>
<!--               <img loading="lazy" src="https://cdn.shopifycdn.net/s/files/1/0749/2039/5067/files/4a67d01d8d77490553a38450996bc7e7.png?v=1682060456"> -->
            </div>
            <div class="fedex_all_boxBOttom_text">
              <span>{{ block.settings.fedex_text1 }}</span>
              <span class="hover_1">{{ block.settings.fedex_svg }}</span>
              <span class="hover_2">{{ block.settings.fedex_text3 }}</span>
              <div class="fedex_all_boxBOttom_hide">
                {{ block.settings.hide_text }}
              </div>
            </div>
          </div>
          <div class="fedex_all_boxBOttom_text2">
            {{ block.settings.text }}
          </div>
        </div>
      {%- when 'buy_buttons' -%}
        <div class="product-meta__price-list-container" role="region" aria-live="polite">
          <div class="pc">
            <div class="product_pay product_pay_price">
              <div>
                <div class="price_title">Price</div>
                <product-meta form-id="{{ product_form_id }}" price-class="price--large" class="">
                  <div class="price-list" data-product-price-list>
                    {%- if product.selected_or_first_available_variant.compare_at_price
                        > product.selected_or_first_available_variant.price
                    -%}
                      <span class="price price--highlight price--large">
                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>

                        {%- if settings.currency_code_enabled -%}
                          {{- product.selected_or_first_available_variant.price | money_with_currency -}}
                        {%- else -%}
                          {{- product.selected_or_first_available_variant.price | money_with_currency -}}
                        {%- endif -%}
                      </span>

                      <span class="price price--compare">
                        <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>

                        {%- if settings.currency_code_enabled -%}
                          {{- product.selected_or_first_available_variant.compare_at_price | money_with_currency -}}
                        {%- else -%}
                          {{- product.selected_or_first_available_variant.compare_at_price | money_with_currency -}}
                        {%- endif -%}
                      </span>
                    {%- else -%}
                      <span class="price price--large">
                        <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                        {%- if settings.currency_code_enabled -%}
                          {{- product.selected_or_first_available_variant.price | money_with_currency -}}
                        {%- else -%}
                          {{- product.selected_or_first_available_variant.price | money_with_currency -}}
                        {%- endif -%}
                      </span>
                    {%- endif -%}

                    {%- if product.selected_or_first_available_variant.unit_price_measurement -%}
                      <div class="price text--subdued">
                        <div class="unit-price-measurement">
                          <span class="unit-price-measurement__price">
                            {{- product.selected_or_first_available_variant.unit_price | money_with_currency -}}
                          </span>
                          <span class="unit-price-measurement__separator">/</span>

                          {%- if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1
                          -%}
                            <span class="unit-price-measurement__reference-value">
                              {{- product.selected_or_first_available_variant.unit_price_measurement.reference_value -}}
                            </span>
                          {%- endif -%}

                          <span class="unit-price-measurement__reference-unit">
                            {{- product.selected_or_first_available_variant.unit_price_measurement.reference_unit -}}
                          </span>
                        </div>
                      </div>
                    {%- endif -%}
                  </div>
                </product-meta>
              </div>
              <div class="product-payment__item-right">
                <span class="pack_item">As low as</span>
                <span class="pack_item pack_title"
                  ><span style="font-size: 1.1em;">${{ product.price | divided_by: 600.0 | round: 1 }}</span>/m at 0%
                  APR</span
                >
                <small class="pack_item"
                  >With
                  <img
                    class="grid-product__price"
                    src="//cdn.shopify.com/s/files/1/0255/9528/1483/files/paypal_credit1.svg?v=1599114685"
                    alt="paypal_credit"
                    width="60px"
                  >
                  <span class="modal-popup modal-popup__link js-no-transition" popupId="popup_paypal"
                    >View details</span
                  >
                  {%- render 'paypal-credit' -%}
                </small>
              </div>
            </div>
          </div>
          <!--
            <div class="product-meta__label-list label-list" data-product-label-list>
              {%- unless product.selected_or_first_available_variant.available -%}
                <span class="label label--subdued">{{ 'collection.product.sold_out' | t }}</span>
              {%- elsif product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price -%}
                {%- if settings.discount_mode == 'percentage' -%}
                  {%- assign savings = product.selected_or_first_available_variant.compare_at_price | minus: product.selected_or_first_available_variant.price | times: 100.0 | divided_by: product.selected_or_first_available_variant.compare_at_price | round | append: '%' -%}
                {%- else -%}
                  {%- capture savings -%}{{ product.selected_or_first_available_variant.compare_at_price | minus: product.selected_or_first_available_variant.price | money }}{%- endcapture -%}
                {%- endif -%}

                <span class="label label--highlight">{{ 'collection.product.discount_html' | t: savings: savings }}</span>
              {%- endunless -%}
            </div>
          -->
        </div>
        {%- if request.page_type != 'password' -%}
          <div class="product-form__buy-buttons" {{ block.shopify_attributes }}>
            {%- form 'product', product, is: 'product-form', id: product_form_id -%}
              <input type="hidden" disabled name="id" value="{{ product.selected_or_first_available_variant.id }}">
              <product-payment-container
                form-id="{{ product_form_id }}"
                {% if update_url %}
                  id="MainPaymentContainer"
                {% endif %}
                class="product-form__payment-container"
                {{ block.shopify_attributes }}
              >
                <button
                  id="AddToCart"
                  type="submit"
                  is="loader-button"
                  {% unless block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}
                    data-use-primary
                  {% endunless %}
                  data-product-add-to-cart-button
                  data-button-content="{% if product.template_suffix == 'pre-order' %}{{ 'product.form.pre_order' | t | escape }}{% else %}{{ 'product.form.add_to_cart' | t | escape }}{% endif %}"
                  class="product-form__add-button button {% unless product.selected_or_first_available_variant.available %}button--ternary{% else %}{% if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}button--secondary{% else %}button--primary{% endif %}{% endunless %} button--full"
                  {% unless product.selected_or_first_available_variant.available %}
                    disabled
                  {% endunless %}
                >
                  {%- if product.selected_or_first_available_variant.available -%}
                    {%- if product.template_suffix == 'pre-order' -%}
                      {{- 'product.form.pre_order' | t -}}
                    {%- else -%}
                      {{- 'product.form.add_to_cart' | t -}}
                    {%- endif -%}
                  {%- else -%}
                    {{- 'product.form.sold_out' | t -}}
                  {%- endif -%}
                </button>

                {%- if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' -%}
                  {{ form | payment_button }}

                  {%- unless product.selected_or_first_available_variant.available -%}
                    <style>
                      #shopify-section-{{ section.id }} .shopify-payment-button {
                        display: none;
                      }
                    </style>
                  {%- endunless -%}
                {%- endif -%}
              </product-payment-container>
            {%- endform -%} <div class="wishlist-engine" data-product_id="{{ product.id }}" data-variant_id="{{ product.selected_or_first_available_variant.id }}" data-full_button="true"></div>
          </div>
        {%- endif -%}

        {%- if template.suffix != 'quick-buy-popover' -%}
          <store-pickup form-id="{{ product_form_id }}" class="product-form__store-availability-container">
            {%- render 'store-availability', product_variant: product.selected_or_first_available_variant -%}
          </store-pickup>
        {%- endif -%}
      {%- when 'free_gifts' -%}
        <div class="x-product-free-gifts">
          <div class="x-product-free-gifts-title">
            {{ block.settings.free_gifts_icon }}
            <span>{{ block.settings.free_gifts_title }}</span>
          </div>
          <div class="x-product-free-gifts-conetent">
            {% if block.settings.free_gifts_text_one != blank %}
            <div class="x-product-free-gifts-item">
              <a href="{{ block.settings.free_gifts_url_one }}">
              <div class="x-product-free-gifts-item-wrap">
                <div class="x-product-free-gifts-item-img">
                  {{ block.settings.free_gifts_img_one | image_url: width: 500 | image_tag }}
                </div>
                <div class="x-product-free-gifts-item-text">
                  <p>{{ block.settings.free_gifts_text_one }}</p>
                  <p>{{ block.settings.free_gifts_price_one }}</p>
                  <p>{{ block.settings.free_gifts_quantity_one }}</p>
                </div>
                <div class="x-product-free-gifts-free">FREE</div>
              </div>
            </a>
            </div>
            {% endif %}
            {% if block.settings.free_gifts_text_two !=blank %}
            <div class="x-product-free-gifts-item">
              <div class="x-product-free-gifts-item-wrap">
                <div class="x-product-free-gifts-item-img">
                  {{ block.settings.free_gifts_img_two | image_url: width: 500 | image_tag }}
                </div>
                <div class="x-product-free-gifts-item-text">
                  <p>{{ block.settings.free_gifts_text_two }}</p>
                  <p>{{ block.settings.free_gifts_price_two }}</p>
                  <p>{{ block.settings.free_gifts_quantity_two }}</p>
                </div>
                <div class="x-product-free-gifts-free">FREE</div>
              </div>
            </div>
            {% endif %}
            {% if block.settings.free_gifts_text_three !=blank %}
            <div class="x-product-free-gifts-item">
              <div class="x-product-free-gifts-item-wrap">
                <div class="x-product-free-gifts-item-img">
                  {{ block.settings.free_gifts_img_three | image_url: width: 500 | image_tag }}
                </div>
                <div class="x-product-free-gifts-item-text">
                  <p>{{ block.settings.free_gifts_text_three }}</p>
                  <p>{{ block.settings.free_gifts_price_three }}</p>
                  <p>{{ block.settings.free_gifts_quantity_three }}</p>
                </div>
                <div class="x-product-free-gifts-free">FREE</div>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
    {%- endcase -%}
  {%- endfor -%}

  {%- comment -%}
    IMPLEMENTATION NOTE: under rare circumstances, merchant may want to show selectors but hide the add to cart button. This
    is however problematic as elements changed based on this. So if we detect there is no buy buttons block, we add an empty one
  {%- endcomment -%}

  {%- assign buy_buttons_block = section.blocks | where: 'type', 'buy_buttons' | first -%}

  {%- if buy_buttons_block == blank -%}
    {%- form 'product', product, is: 'product-form', id: product_form_id -%}
      <input type="hidden" disabled name="id" value="{{ product.selected_or_first_available_variant.id }}">
    {%- endform -%} <div class="wishlist-engine" data-product_id="{{ product.id }}" data-variant_id="{{ product.selected_or_first_available_variant.id }}" data-full_button="true"></div>
  {%- endif -%}
</div>

{%- if template.suffix == 'quick-buy-drawer' -%}
  <div class="product-form__view-details">
    <a href="{{ product.url }}" class="link text--subdued">{{ 'product.general.view_details' | t }}</a>
  </div>
{%- endif -%}

{%- comment -%}
  IMPLEMENTATION NOTE: if during the iteration of the options we have found an option matching a size chart, we add it here
{%- endcomment -%}

{%- if found_size_option and size_chart_page != blank -%}
  {%- comment -%}Drawer is for tablet and desktop{%- endcomment -%}
  <drawer-content
    id="product-{{ section.id }}-{{ product.id }}-size-chart-drawer"
    class="drawer drawer--large hidden-phone"
  >
    <span class="drawer__overlay"></span>

    <header class="drawer__header">
      <p class="drawer__title heading h6">{{ size_chart_page.title }}</p>

      <button
        type="button"
        class="drawer__close-button tap-area"
        data-action="close"
        title="{{ 'general.accessibility.close' | t | escape }}"
      >
        {%- render 'icon' with 'close' -%}
      </button>
    </header>

    <div class="drawer__content drawer__content--padded-start">
      <div class="rte">
        {{- size_chart_page.content -}}
      </div>
    </div>
  </drawer-content>

  {%- comment -%}Popover is for mobile{%- endcomment -%}
  <popover-content id="product-{{ section.id }}-{{ product.id }}-size-chart-popover" class="popover hidden-lap-and-up">
    <span class="popover__overlay"></span>

    <header class="popover__header">
      <p class="popover__title heading h6">{{ size_chart_page.title }}</p>

      <button
        type="button"
        class="popover__close-button tap-area tap-area--large"
        data-action="close"
        title="{{ 'general.accessibility.close' | t | escape }}"
      >
        {%- render 'icon' with 'close' -%}
      </button>
    </header>

    <div class="popover__content">
      <div class="rte">
        {{- size_chart_page.content -}}
      </div>
    </div>
  </popover-content>
{%- endif -%}

<script>
  {% if product.title == "Bee Challenger" %}
  (function () {
    let product_color_selected = document.querySelectorAll(".color-swatch-list .color-swatch")
    console.log(product_color_selected.length,"test lenght")
    product_color_selected[0].querySelector("label").style.backgroundImage = "url('https://cdn.shopifycdn.net/s/files/1/0554/7098/1274/files/cha_-1.jpg?v=1675845937')"
    product_color_selected[1].querySelector("label").style.backgroundImage = "url('https://cdn.shopifycdn.net/s/files/1/0554/7098/1274/files/cha_2bf9982a-79a0-4ba2-b8dc-46c873cd12e6.jpg?v=1675845341')"
    product_color_selected[2].querySelector("label").style.backgroundColor = "black"
  })()
  {% endif %}

  {% if product.title != "Bee Pathfinders “Free Mix” Bundle" %}
 (function () {
  
    let add_to_cart = document.querySelector("#AddToCart")
    let product_count = document.querySelector(".quantity-selector__input")
    let color_lists = document.querySelectorAll(".color-swatch-list .color-swatch")
    
    add_to_cart.addEventListener("click", (e) => {
      e.preventDefault()
      let number_product_count = parseInt(product_count.value)
      let product_id = document.querySelector('.product-form__buy-buttons .shopify-product-form').querySelector('[name="id"]').value
      let formData = {
       'items': [{
        'id': 45298400756025,
        'quantity': number_product_count
        },{
        'id':!!product_id ? parseInt(product_id) : {{ product.selected_or_first_available_variant.id }} ,
        'quantity': number_product_count
        }]
      };
      fetch(window.Shopify.routes.root + 'cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      })
      .then(response => {
        window.location.href = "/cart"
        return response.json();
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    })
  
})()
  {% endif %}

  {% if product.title == "Bee Pathfinder Step-Thru" %}
    let product_color_selected = document.querySelectorAll(".color-swatch-list .color-swatch")
    let product_color_list = ["red", "orange", "green", "#017FA8", "#734D9D", "#FFF", "#000"]
    product_color_list.forEach((item, index) => {
       product_color_selected[index].querySelector("label").style.backgroundColor = item
    })
  {% endif %}
</script>